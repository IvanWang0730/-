<!DOCTYPE html>












































































































































































































<html>
	<head>
		<meta charset="utf-8">
		<title>
		</title>
		<style>
			body {
				background-color: floralwhite;
			}
			
			#SVG{
				background-color: white;
			}
			
			.textblock{
				border:1px solid gray;
				width:300px;
				/* border-radius:10px; */
				overflow-x: hidden;
				background-color: white;
			}
			
			.textblock::-webkit-scrollbar {/*滚动条整体样式*/
				width: 20px;     /*高宽分别对应横竖滚动条的尺寸*/
				height: 4px;
				scrollbar-arrow-color:red;
			 }
			.textblock::-webkit-scrollbar-thumb {/*滚动条里面小方块*/
				border-radius: 5px;
				-webkit-box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
				background: rgba(0,0,0,0.2);
				scrollbar-arrow-color:red;
			}
			.textblock::-webkit-scrollbar-track {/*滚动条里面轨道*/
				-webkit-box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
				border-radius: 0;
				background: rgba(0,0,0,0.1);
			}
			
			.container{
				border:1px solid black;
				width:450px;
				border-radius:10px;
				margin:20px 20px 20px 15px;
				max-width: 450px;
				box-shadow:1px 2px 3px 4px #adadad;
				overflow: hidden;
				word-break: break-word;	
			}
			
			.text{
				margin:10px;
				font-size:20px;
			}
			
			.tags{
				color:#55aaff;
			}
			
			.author{
				color:#ff5500;
			}
			
			.time{
				margin: 10px;
			}
			
			/* 提示框 */
			.tooltip {
			  position: absolute;
			  padding: 7px;
			  font-size: 1.5em;
			  pointer-events: none;
			  background: #fff;
			  border: 1px solid #ccc;
			  border-radius: 4px;
			
			  /* 添加阴影效果 */
			  -moz-box-shadow:    3px 3px 10px 0px rgba(0, 0, 0, 0.25);
			  -webkit-box-shadow: 3px 3px 10px 0px rgba(0, 0, 0, 0.25);
			  box-shadow:         3px 3px 10px 0px rgba(0, 0, 0, 0.25);
			}
			
			.tooltip p {
			  margin: 0;
			  padding: 0;
			}
			
			.tooltip table {
			  margin: 0;
			  padding: 0;
			  border-collapse: collapse;
			}
			
			.lsiblock{
				border:1px solid gray;
				width:1800px;
				height: 1200px;
				border-radius:10px;
				overflow-x: hidden;
				overflow-y: hidden;
				background-color: white;
				margin:50px 20px 0px 110px;
				
			}
			
			#leftblock{
				background-color: floralwhite;
			}
			
			h2 {
			  line-height: 1em;
			  font-size: 1.75em;
			  font-weight: 900;
			  color: #000;
			}
			
			h2.year {
			  margin: 10px 0px 0px 70px;
			  font-size: 1.3em;
			  font-weight: 700;
			}
			
			.input_topic {
			  display: block;
			  width: 200px;
			  margin: 10px 0px 0px 70px;
			}
		</style>
		<script src="https://d3js.org/d3.v7.min.js"></script>
		<script src="https://unpkg.com/topojson-client@3"></script>
		<script src="d3-cloud-master\build\d3.layout.cloud.js"></script>
		
	</head>
	<body>
		
		<form name="main" action="" method="" style="position:absolute;top:0px;left:0px;">
		<div class="textblock" id="leftblock" style="width: 2020px;height: 1389px;">
			<div class="lsiblock">
				<h2 class="year"></h2>
				<div class="slider"></div>
				<div id="lsi" style="position: relative;top:250px;left:430px;transform: scale(1.4);"></div>
			</div>
			<div class="lsiblock">
				<select id="option_area"  name="option" style = "height:50px;font-size:30px;border-radius:10px;background:white;color:black;top: 100px">
					<option value="0" id="Relevant">mbdata/ccdata</option>
					<option value="1" id="Chatter">Relevant/Chatter/Spam</option>
					<option value="2" id="POK">POK</option>
				</select>
				<svg id="SVG"></svg>
				
			</div>
			<div class="lsiblock">
				<h2 style="text-align: center;">Write Down Box</h2>
				<textarea style="width: 1600px;height: 900px;font-size:30px;margin: 50px 0px 0px 100px;padding: 20px 20px 20px 20px;"></textarea>
			</div>
		</div>
		<!-- <form name="block" action="" method="" style="position:absolute;top:0px;left:0px;">
		<div id="out" style="width: 900px;height: 650px;transform: scale(0.70)">
		</div>
		</form> -->
		</form>
		
		
		<script>
			const width = 2020
			const height = 1200
			const margin = 70
			
			const svg = d3.select("#SVG")
					.attr("width", width)
					.attr("height", height)
					.attr('transform', `translate(${-6}, ${0})`);
					
			svg.append("rect").attr("width", 1900).attr("height", 1200)
				.attr("transform", `translate(${0}, ${0})`)
				.attr("rx", 10).attr("ry", 10)
				.attr("fill", "white")
				.attr("stroke", "gray")
				.attr("stroke-width", "1px")
				.attr("opacity", 1)
			
			d3.json("Abila.json").then(function (data){
				const map = svg.append("g").attr("transform", `translate(${margin}, ${3*margin})`)
				
				const projection = d3.geoMercator()
				const pathGenerator = d3.geoPath().projection(projection);
				
				worldmeta = topojson.feature(data, data.objects.Abila);
				console.log(worldmeta.features)
				projection.fitSize([width/2-2*margin, height/2-2*margin], worldmeta);
				
				const paths = map.selectAll('path')
					.data(worldmeta.features, d => d.properties.FENAME)
					.enter().append('path')
					.attr('d', pathGenerator)
					.attr('stroke', 'black')
					.attr('stroke-width', 1)
					.attr("fill", "none");
				
				const arc = d3.arc()
					.innerRadius(height/3-margin/2)
					.outerRadius(width*2)
					.startAngle(0)
					.endAngle(2*Math.PI)
					.padAngle(0.0);
					
				map.append("g")
					.append("path")
					.attr("d", arc)
					.attr("fill", "white")
					.attr("stroke-width", "1px")
					.attr("stroke", "#000002")
					.attr("transform", `translate(${6.2*margin}, ${3.8*margin})`);

					
				d3.json("mbdata.json").then(function (mbdata){
					console.log(mbdata)
					
					const arc2 = d3.arc()
						.innerRadius(height/3-margin/2)
						.outerRadius(d => height/3-margin/2+d.pos*100)
						.startAngle((d,i) => i*2*Math.PI/2137)
						.endAngle((d,i) => (i+1)*2*Math.PI/2137);
						
					const arcs2 = map.append("g")
						.selectAll()
						.data(mbdata.Relevant).enter()
						.append("path")
						.attr("d", arc2)
						.attr("fill", "white")
						.attr("stroke-width", "0.0px")
						.attr("stroke", "#000002")
						.attr("class", "path_map")
						.attr("transform", `translate(${6.2*margin}, ${3.8*margin})`)
						.on("mouseover", function (event, d){
							tooltip.transition()
								.duration(250) // 设置transition效果的速度，默认为500ms
								.style("opacity", 1);
							
							tooltip.html(
									"<p><b>" + "Emotion Rate" + "</b></p>"
								)
								.style("left", (event.pageX + 15) + "px")
								.style("top", (event.pageY - 28) + "px");
						})
						.on("mouseout", function (){
							tooltip.transition()
								.duration(250)
								.style("opacity", 0);
						});
					
					const brushmap = svg.append("g");
					
					brushmap.append("rect").attr("width", width).attr("height", 3.5*margin)
						.attr("transform", `translate(${0}, ${height-3.5*margin})`)
						.attr("fill", "white")
						.attr("stroke", "gray")
						.attr("stroke-width", "1px")
						.attr("opacity", 1)
					
					const scaleX = d3.scaleTime()
						.domain([d3.min(mbdata.Relevant, d=>new Date(d.date)), d3.max(mbdata.Relevant, d=>new Date(d.date))])
						.range([0.1*margin, width-3.1*margin]);
					const [x0, x1] = [d3.min(mbdata.Relevant, d=>new Date(d.date)), d3.max(mbdata.Relevant, d=>new Date(d.date))]
					const axisX = d3.axisBottom(scaleX)
									.ticks(10)
									.tickFormat(d3.timeFormat('%H:%M'))
									.tickSize(10);
					brushmap.append("g").call(axisX)
							.attr("transform", `translate(${0}, ${height-1.5*margin})`)
							.selectAll("text").style("font-size", "20px") 
					
					const scaleY = d3.scaleLinear()
						.domain([0, d3.max(mbdata.Relevant, d=>d.cnt)])
						.range([height-1.5*margin, height-3.5*margin])
						
					const AreaGenerator = d3.area().curve(d3.curveBasis)
								.x(d => scaleX(new Date(d.date)))
								.y0(d => scaleY(0))
								.y1(d => scaleY(d.cnt));
					const mbarea = brushmap.append("g").data(mbdata.Relevant)
						.append("path")
						.attr("d", AreaGenerator(mbdata.Relevant))
						.attr("fill", "#f4606c")
						.attr("stroke-width", "1.5px")
						.attr("stroke", "none")
						.attr("class", "area0")
						.attr("id", "mbarea")
						.on("mouseover", function(){
							d3.selectAll("#ccarea").attr("opacity", 0)
						})
						.on("mouseout", function(){
							d3.selectAll(".area0").attr("opacity", 1)
						});
					const ccarea = brushmap.append("g").data(mbdata.ccdata)
						.append("path")
						.attr("d", AreaGenerator(mbdata.ccdata))
						.attr("fill", "#ffaa7f")
						.attr("stroke-width", "1.5px")
						.attr("stroke", "none")
						.attr("class", "area0")
						.attr("id", "ccarea")
						.on("mouseover", function(){
							d3.selectAll("#mbarea").attr("opacity", 0)
						})
						.on("mouseout", function(){
							d3.selectAll(".area0").attr("opacity", 1)
						});
						
					d3.selectAll("#option_area")
						.on("change", function(){
							console.log(+document.main.option.value)
							if (+document.main.option.value==0){
								d3.selectAll(".area1").remove()
								
								const mbarea = brushmap.append("g").data(mbdata.Relevant)
									.append("path")
									.attr("d", AreaGenerator(mbdata.Relevant))
									.attr("fill", "#f4606c")
									.attr("stroke-width", "1.5px")
									.attr("stroke", "none")
									.attr("class", "area0")
									.attr("id", "mbarea")
									.on("mouseover", function(){
										d3.selectAll("#ccdata").attr("opacity", 0)
									})
									.on("mouseout", function(){
										d3.selectAll(".area0").attr("opacity", 1)
									});
								const ccarea = brushmap.append("g").data(mbdata.ccdata)
									.append("path")
									.attr("d", AreaGenerator(mbdata.ccdata))
									.attr("fill", "#ffaa7f")
									.attr("stroke-width", "1.5px")
									.attr("stroke", "none")
									.attr("class", "area0")
									.attr("id", "ccarea")
									.on("mouseover", function(){
										d3.selectAll("#mbdata").attr("opacity", 0)
									})
									.on("mouseout", function(){
										d3.selectAll(".area0").attr("opacity", 1)
									});
									
								brushmap.append("circle").attr("r", 10).attr("fill", "#f4606c")
										.attr("cx", 5*margin).attr("cy", height-3*margin).attr("class", "area0")
								brushmap.append("text").text("mbdata").attr("class", "area0")
									.attr("transform", `translate(${5*margin+10}, ${height-3*margin+5})`)
								brushmap.append("circle").attr("r", 10).attr("fill", "#ffaa7f")
										.attr("cx", 5*margin+100).attr("cy", height-3*margin).attr("class", "area0")
								brushmap.append("text").text("ccdata").attr("class", "area0")
									.attr("transform", `translate(${5*margin+110}, ${height-3*margin+5})`)
							}
							if (+document.main.option.value==1){
								d3.selectAll(".area0").remove()
								
								const chatterarea = brushmap.append("g").data(mbdata.Chatter)
									.append("path")
									.attr("d", AreaGenerator(mbdata.Chatter))
									.attr("fill", "#ffaaff")
									.attr("stroke-width", "1.5px")
									.attr("stroke", "none")
									.attr("class", "area1")
									.attr("id", "chatterarea")
									.on("mouseover", function(){
										d3.selectAll("#relevantarea").attr("opacity", 0)
										d3.selectAll("#spamarea").attr("opacity", 0)
									})
									.on("mouseout", function(){
										d3.selectAll(".area1").attr("opacity", 1)
									});
								const spamarea = brushmap.append("g").data(mbdata.Spam)
									.append("path")
									.attr("d", AreaGenerator(mbdata.Spam))
									.attr("fill", "#00aa7f")
									.attr("stroke-width", "1.5px")
									.attr("stroke", "none")
									.attr("class", "area1")
									.attr("id", "spamarea")
									.on("mouseover", function(){
										d3.selectAll("#relevantarea").attr("opacity", 0)
										d3.selectAll("#chatterarea").attr("opacity", 0)
									})
									.on("mouseout", function(){
										d3.selectAll(".area1").attr("opacity", 1)
									});
								const relevantarea = brushmap.append("g").data(mbdata.Relevant)
									.append("path")
									.attr("d", AreaGenerator(mbdata.Relevant))
									.attr("fill", "#55aaff")
									.attr("stroke-width", "1.5px")
									.attr("stroke", "none")
									.attr("class", "area1")
									.attr("id", "relevantarea")
									.on("mouseover", function(){
										d3.selectAll("#chatterarea").attr("opacity", 0)
										d3.selectAll("#spamarea").attr("opacity", 0)
									})
									.on("mouseout", function(){
										d3.selectAll(".area1").attr("opacity", 1)
									});
								
								brushmap.append("circle").attr("r", 10).attr("fill", "#55aaff")
										.attr("cx", 5*margin).attr("cy", height-3*margin).attr("class", "area1")
								brushmap.append("text").text("Relevant").attr("class", "area1")
									.attr("transform", `translate(${5*margin+10}, ${height-3*margin+5})`)
								brushmap.append("circle").attr("r", 10).attr("fill", "#ffaaff")
										.attr("cx", 5*margin+100).attr("cy", height-3*margin).attr("class", "area1")
								brushmap.append("text").text("Chatter").attr("class", "area1")
									.attr("transform", `translate(${5*margin+110}, ${height-3*margin+5})`)
								brushmap.append("circle").attr("r", 10).attr("fill", "#00aa7f")
										.attr("cx", 5*margin+200).attr("cy", height-3*margin).attr("class", "area1")
								brushmap.append("text").text("Spam").attr("class", "area1")
									.attr("transform", `translate(${5*margin+210}, ${height-3*margin+5})`)
							}
							if (+document.main.option.value==2){
								d3.selectAll(".container").remove()
								key_mbdata = new Array()
								for (let item of mbdata["Relevant"]){
									if (item.author == "POK"){
										key_mbdata.push(item)
									}
								}
								d3.select("#blocktitle").text(key_mbdata.length+"/"+mbdata["Relevant"].length)
								var container = d3.select("#Relevantblock")
									.selectAll(".container").data(key_mbdata).enter()
									.append("div")
									.attr("class", "container")
									.attr("id", "container_Relevant")
								container.append("p").text(d=>d.time).attr("class", "time")
								var text = container.append('p')
									.attr('class', 'text')
								text.append("span")
									.text(d=>d.author+": ")
									.attr("class", "author")
								text.append("span")
									.text(d=>d.rt)
									.attr("class", "tags")
								text.append("span")
									.text(d=>d.message)
								text.append("span")
									.text(d=>d.tags)
									.attr("class", "tags")
							}
						})
					
					// Legend_area
					brushmap.append("circle").attr("r", 10).attr("fill", "#f4606c")
							.attr("cx", 5*margin).attr("cy", height-3*margin).attr("class", "area0")
					brushmap.append("text").text("mbdata").attr("class", "area0")
						.attr("transform", `translate(${5*margin+10}, ${height-3*margin+5})`)
					brushmap.append("circle").attr("r", 10).attr("fill", "#ffaa7f")
							.attr("cx", 5*margin+100).attr("cy", height-3*margin).attr("class", "area0")
					brushmap.append("text").text("ccdata").attr("class", "area0")
						.attr("transform", `translate(${5*margin+110}, ${height-3*margin+5})`)
						
					// Legen_map
					map.append("circle").attr("r", 10).attr("fill", "#ffaa7f")
							.attr("cx", 8*margin).attr("cy", 20)
					map.append("text").text("mbdata")
						.attr("transform", `translate(${8*margin+15}, ${25})`)
					map.append("circle").attr("r", 10).attr("fill", "#f4606c")
							.attr("cx", 8*margin).attr("cy", 50)
					map.append("text").text("ccdata")
						.attr("transform", `translate(${8*margin+15}, ${55})`)
						
						
					let tooltip = d3.select("body").append("div")
						.attr("class", "tooltip")
						.style("opacity", 0);
					
					const cccircle = map.append("g")
						.selectAll()
						.data(mbdata.ccdata).enter()
						.append("circle")
						.attr("cx", d => projection([d.longitude,d.latitude])[0])
						.attr("cy", d => projection([d.longitude,d.latitude])[1])
						.attr("r", 7)
						.attr("class", "circle_map")
						.attr("fill", "#f4606c")
						.on("mouseover", function (event, d){
							d3.select(this).attr("r", 9);
							
							tooltip.transition()
								.duration(250) // 设置transition效果的速度，默认为500ms
								.style("opacity", 1);
							
							tooltip.html(
									"<p><b>" + d.time + "</b></p>" +
									"<tr><td>Location:</td><td>" + d.location + "</td></tr>" + 
									"<table><tbody><tr><td class='wide'>Message:</td><td>" + d.message + "</td></tr>"
								)
								.style("left", (event.pageX + 15) + "px")
								.style("top", (event.pageY - 28) + "px");
						})
						.on("mouseout", function (){
							d3.select(this).attr("r", 7);
							
							tooltip.transition()
								.duration(250)
								.style("opacity", 0);
						});
						
					
					const circle = map.append("g")
						.selectAll()
						.data(mbdata.Relevant).enter()
						.append("circle")
						.attr("cx", d => projection([d.longitude,d.latitude])[0])
						.attr("cy", d => projection([d.longitude,d.latitude])[1])
						.attr("r", 7)
						.attr("opacity", 1)
						.attr("fill", "#ffaa7f")
						.attr("class", "circle_map")
						.attr("title", d=>d.message)
						.on("mouseover", function (event, d){
							d3.select(this).attr('r', 9)
							
							tooltip.transition()
								.duration(250) // 设置transition效果的速度，默认为500ms
								.style("opacity", 1);
							
							tooltip.html(
									"<p><b>" + d.time + "</b></p>" +
									"<tr><td>Author:</td><td>" + d.author + "</td></tr>" + 
									"<table><tbody><tr><td class='wide'>Message:</td><td>" + d.message + "</td></tr>"
								)
								.style("left", (event.pageX + 15) + "px")
								.style("top", (event.pageY - 28) + "px");
						})
						.on("mouseout", function (){
							d3.select(this).attr('stroke', "none")
							
							tooltip.transition()
								.duration(250)
								.style("opacity", 0);
						})
						.on("click", function(event, d){
							// 图
							createforcegraph(d)
						});
					
					function createforcegraph(d) {
						d3.json("graph.json").then(function (data){
							var nodes = new Array()
							var links = new Array()
							nodes.push({"id":d.author, "group":1})
							for (let person of data[d.author]){
								nodes.push({"id":person, "group":1})
								links.push({"source":d.author, "target":person, "value":2})
							}
							var graph = {"nodes": nodes, "links": links}
							console.log(graph)
							
							let simulation = d3.forceSimulation(graph.nodes)
								.force("link", d3.forceLink(graph.links)	
									  .id(d => d.id)
									  .strength(d => d.source.group === d.target.group ? 1 : 0.3))
								.force("charge", d3.forceManyBody().strength(-125)) 
								.force("center", d3.forceCenter(0.7*width, 0.65*height));
							
							function convexHulls(nodes) {
								
								let offset = 15; // 可以控制区域边界大小
								let hulls = {};
							
								for (let k=0; k<nodes.length; ++k) {
									let n = nodes[k];
									if (n.size) continue;
									let i = n.group, l = hulls[i] || (hulls[i] = []);
							
									// l 记录了一个点的正方形区域的四个顶点
									l.push([n.x-offset, n.y-offset]);
									l.push([n.x-offset, n.y+offset]);
									l.push([n.x+offset, n.y-offset]);
									l.push([n.x+offset, n.y+offset]);
							}
							
							let hullset = [];
							for (i in hulls) {
									// d3.polygonHull可以求多边形最外层的点，返回的顺序是顺时针
									hullset.push({group: i, path: d3.polygonHull(hulls[i])});
								}
								return hullset;
							}
							
							// d3.line.curve()方法用于绘制一条曲线
							let curve = d3.line().curve(d3.curveCardinalClosed.tension(0.01));
							
							// 分类绘制凸壳
							function drawCluster(d) {
								//返回曲线路径
								return curve(d.path);
							}
							
							//定义凸壳组件
							let hulls = svg.append("g")
								.selectAll("path.hull")
								.data(convexHulls(graph.nodes))
								.enter()
								.append("path")
								.attr("class", "hull")
								.attr("d", drawCluster)
								.style("fill", function(d) { return fill(d.group); });
							
							// 定义人物节点之间连线的信息
							let link = svg.append("g")
								.attr("stroke", "#999")
								.attr("stroke-opacity", 0.6)
								.selectAll("line") // 用line元素来绘制
								.data(graph.links) // 绑定json文件中的links数据
								.join("line")
								.attr("stroke-width", d => Math.sqrt(d.value)); // 连线粗细通过线的value计算
							
							// 定义人物节点信息
							let node = svg.append("g")
								.attr("stroke", "#fff")
								.attr("stroke-width", 1.5)
								.selectAll("circle") // 人物节点通过圆来绘制 
								.data(graph.nodes)// 为人物节点绑定nodes数据
								.join("circle")
								.attr("r", 5)// 设置节点半径
								.attr("fill", function(d) { return fill(d.group); })  // 设置节点的填充色，通过节点的group属性来计算节点的填充颜色
								// .call(
							
									// 
									//  Q2: 增加拖拽事件，调用后面定义的三个阶段的监听函数 //
								.call(
									d3.drag()
									.on("start", dragstarted)
									.on("drag", dragged)
									.on("end", dragended)
								)
									// 
							
								// )
								.on('mouseover', function (event,d) {
							
									// 
									//  Q3: 鼠标hover的时候圆圈放大效果
									// 
							
									d3.select(this).transition().attr("r", 10);
							
									tooltip.transition()
										.duration(250) // 设置transition效果的速度，默认为500ms
										.style("opacity", 1);
							
									tooltip.html(
										"<p> Name: " + d.id + "<br>" + 'Group: ' + d.group + "</p>"
									)
										// 设置tooltip距离鼠标的相对位置
										.style("left", (event.pageX + 15) + "px")
										.style("top", (event.pageY - 28) + "px");
							
								})
								.on('mouseout', function (event,d) {
							
									// 
									//  Q3: 鼠标离开的时候圆圈还原
									//
									
									d3.select(this).transition().attr("r", 5);
							
									tooltip.transition()
										.duration(250)
										.style("opacity", 0);
							
								});
								
							simulation.on("tick", () => {
							
								// 每次tick计时到时，连接线的响应动作
								link
									.attr("x1", d => d.source.x)
									.attr("y1", d => d.source.y)
									.attr("x2", d => d.target.x)
									.attr("y2", d => d.target.y);
							
								// 每次tick计时到时，节点的响应动作
								node
									.attr("cx", d => d.x)
									.attr("cy", d => d.y);
								
								// 每次tick计时到时，凸壳的响应动作
								hulls
									.data(convexHulls(graph.nodes))
									.attr("d", drawCluster);
								});
							
							// 定义开始拖拽节点时的动作，注意v6版本是通过event返回的函数参数来处理的
							function dragstarted(event) {
								
								// 当开始拖动时，restart()方法重新启动模拟器的内部计时器并返回模拟器，
								// alpha将保持在0.3左右，使模拟不断移动
								if (!event.active) simulation.alphaTarget(0.3).restart();
								event.subject.fx = event.subject.x;
								event.subject.fy = event.subject.y;
							}
							
							// 定义拖拽中的动作
							function dragged(event) {
								event.subject.fx = event.x;
								event.subject.fy = event.y;
							}
							
							// 定义拖拽结束的动作
							// 在拖动结束时，alphaTarget被设置回0，因此再次稳定下来，这就是阻力相互作用后力返回的原因
							function dragended(event) {
								if (!event.active) simulation.alphaTarget(0);
								event.subject.fx = null;
								event.subject.fy = null;
							}
						})
						
					}
						
					const brush = d3.brushX()
						.extent([[0.1*margin, height-1.5*margin], [width-3.1*margin, height]])
						.on("start brush end", brushed);
					
					svg.append("g")
						.call(brush)
						.call(brush.move, [3, 5].map(scaleX))
						.on("dblclick", dblclicked);
						
					function dblclicked() {
						const selection = d3.brushSelection(this) ? null : scaleX.range();
						d3.select(this).call(brush.move, selection);
						circle.attr("cx", d => projection([d.longitude,d.latitude])[0])
							.attr("cy", d => projection([d.longitude,d.latitude])[1])
						
						change(d3.min(mbdata["Relevant"], d=>new Date(d.date)), d3.max(mbdata["Relevant"], d=>new Date(d.date)))
						d3.selectAll(".circle_map").attr("r", 0);
						d3.selectAll(".path_map").attr("fill", "gray")
					};
					
					function brushed({selection}){
						if (selection === null) {
							// const [x0, x1] = [0, 2000];
						} else {
							const [x0, x1] = selection.map(scaleX.invert);
							change(x0, x1);
						};
					};
					
					function change(x0, x1){
						circle.attr("r", d => x0 <= new Date(d.date) && new Date(d.date) <= x1 ? 7:0)
						cccircle.attr("r", d => x0 <= new Date(d.date) && new Date(d.date) <= x1 ? 7:0)
						arcs2.attr("fill", d =>{
							if (x0 <= new Date(d.date) && new Date(d.date) <= x1){
								if (d.pos>=0.5){
									return "#ffaa7f"
								} else{
									return "#8cc7b5"
								}
							} else{
								return "gray"
							}
						})
						
						d3.selectAll(".container").remove()
						
						var choice = document.getElementById("test")[+document.single.test.value].id
						var new_choice_mbdata = new Array()
						for (let item of mbdata[choice]){
							if (x0 <= new Date(item.date) && new Date(item.date) <= x1){
								new_choice_mbdata.push(item)
							}
						}
						d3.select("#blocktitle").text(new_choice_mbdata.length+"/"+mbdata[choice].length)
						var container = d3.select("#Relevantblock")
							.selectAll(".container").data(new_choice_mbdata).enter()
							.append("div")
							.attr("class", "container")
							.attr("id", "container_"+choice)
						container.append("p").text(d=>d.time).attr("class", "time")
						var text = container.append('p')
							.attr('class', 'text')
						text.append("span")
							.text(d=>{
								if (+document.single.test.value !== 3){
									return d.author+": "
								} else {
									if (d.location !== 0){
										return d.location+": "
									} else {
										return ""
									}
								}
							})
							.attr("class", "author")
						text.append("span")
							.text(d=>d.rt)
							.attr("class", "tags")
						text.append("span")
							.text(d=>d.message)
						text.append("span")
							.text(d=>d.tags)
							.attr("class", "tags")
						
							
						d3.selectAll("#test")
							.on("change", function(){
								d3.selectAll(".container").remove()
								if (+document.single.test.value == 0){var choice = "Relevant"}
								if (+document.single.test.value == 1){var choice = "Chatter"}
								if (+document.single.test.value == 2){var choice = "Spam"}
								if (+document.single.test.value == 3){
									d3.selectAll(".keyword").attr("opacity", 0)
									
									var new_ccdata = new Array()
									for (let item of mbdata.ccdata){
										if (x0 <= new Date(item.date) && new Date(item.date) <= x1){
											new_ccdata.push(item)
										}
									}
									d3.select("#blocktitle").text(new_ccdata.length+"/"+mbdata["ccdata"].length)
									var container = d3.select("#Relevantblock")
										.selectAll('.container').data(new_ccdata).enter()
										.append('div')
										.attr('class', 'container')
										.attr("id", "container_cc")
									container.append("p").text(d=>d.time).attr("style", "margin:10px")
									var text = container.append('p')
										.attr('class', 'text')
									text.append("span")
										.text(d=>d.location !== 0 ? d.location+": " : "")
										.attr("class", "author")
									text.append("span")
										.text(d=>d.message)
								} else {
									var new_choice_mbdata = new Array()
									for (let item of mbdata[choice]){
										if (x0 <= new Date(item.date) && new Date(item.date) <= x1){
											new_choice_mbdata.push(item)
										}
									}
									d3.select("#blocktitle").text(new_choice_mbdata.length+"/"+mbdata[choice].length)
									var container = d3.select("#Relevantblock")
										.selectAll('.container').data(new_choice_mbdata).enter()
										.append('div')
										.attr('class', 'container')
										.attr("id", "container_"+choice)
									container.append("p").text(d=>d.time).attr("class", "time")
									var text = container.append('p')
										.attr('class', 'text')
									text.append("span")
										.text(d=>d.author+": ")
										.attr("class", "author")
									text.append("span")
										.text(d=>d.rt)
										.attr("class", "tags")
									text.append("span")
										.text(d=>d.message)
									text.append("span")
										.text(d=>d.tags)
										.attr("class", "tags")
										
									d3.selectAll("#cloud").remove()
									var worddict = {}
									for (let item of mbdata[choice]){
										for (let key in item.tfidf){
											if (x0 <= new Date(item.date) && new Date(item.date) <= x1){
												if (key in worddict){
													worddict[key] += item.tfidf[key]
												} else {
													worddict[key] = item.tfidf[key]
												}
											}
										}
									}
									var res = Object.keys(worddict).sort(function(a,b){return -worddict[a]+worddict[b];})
									words = new Array()
									var n = 0
									for (let word of res){
										if (n>50){break}
										words.push({"text":word, "size":10+100*worddict[word]/d3.max(Object.values(worddict),d=>d)})
										n += 1
									}
									
									d3.layout.cloud().size([500, 500])
									.words(words)
									.rotate(function() { return 0; })
									.rotate(function() { return ~~(Math.random() * 2) * 90; })
											.font("Impact")
											.fontSize(function(d) { return d.size; })
											.on("end", draw)//结束时运行draw函数
											.start();
								}
							});
							
						
						var choice = document.getElementById("test")[+document.single.test.value].id
						d3.selectAll("#cloud").remove()
						var worddict = {}
						for (let item of mbdata[choice]){
							for (let key in item.tfidf){
								if (x0 <= new Date(item.date) && new Date(item.date) <= x1){
									if (key in worddict){
										worddict[key] += item.tfidf[key]
									} else {
										worddict[key] = item.tfidf[key]
									}
								}
							}
						}
						var res = Object.keys(worddict).sort(function(a,b){return -worddict[a]+worddict[b];})
						words = new Array()
						var n = 0
						for (let word of res){
							if (n>50){break}
							words.push({"text":word, "size":10+100*worddict[word]/d3.max(Object.values(worddict),d=>d)})
							n += 1
						}
						
						d3.layout.cloud().size([500, 500])
						.words(words)
						.rotate(function() { return 0; })
						.rotate(function() { return ~~(Math.random() * 2) * 90; })
								.font("Impact")
								.fontSize(function(d) { return d.size; })
								.on("end", draw)//结束时运行draw函数
								.start();
								
						function draw(words) {
							var choice = document.getElementById("test")[+document.single.test.value].id
							svg.append("g").attr("id", "cloud")
								.attr("style", "border:1px solid red")
								.attr("transform", `translate(${width-7.5*margin},${4.6*margin})`)
								.selectAll("text")
								.data(words)
								.enter().append("text")
								.style("border","1px solid blue")
								.style("font-size", function(d) { return d.size + "px"; })
								.style("font-family", "Impact")
								.style("fill", function(d, i) { return fill(i); })//fill 在前面15行定义为颜色集
								.attr("text-anchor", "middle")
								.attr("class", "keyword")
								.attr("id", d=>d.text)
								.attr("transform", function(d) {
									return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
								})
								.text(function(d) { return d.text; })
								.on("click", function (){
									if (d3.select(this).attr("opacity")==0.9){
										d3.selectAll(".keyword").attr("opacity", 1)
										
										d3.selectAll(".container").remove()
										key_mbdata = new Array()
										for (let item of mbdata[choice]){
											if (x0 <= new Date(item.date) && new Date(item.date) <= x1){
												key_mbdata.push(item)
											}
										}
										d3.select("#blocktitle").text(key_mbdata.length+"/"+mbdata[choice].length)
										var container = d3.select("#Relevantblock")
											.selectAll(".container").data(key_mbdata).enter()
											.append("div")
											.attr("class", "container")
											.attr("id", "container_"+choice)
										container.append("p").text(d=>d.time).attr("class", "time")
										var text = container.append('p')
											.attr('class', 'text')
										text.append("span")
											.text(d=>d.author+": ")
											.attr("class", "author")
										text.append("span")
											.text(d=>d.rt)
											.attr("class", "tags")
										text.append("span")
											.text(d=>d.message)
										text.append("span")
											.text(d=>d.tags)
											.attr("class", "tags")
									} else {
										d3.selectAll(".keyword").attr("opacity", 0.3)
										d3.select(this).attr("opacity", 0.9)
										
										console.log(d3.select(this).attr("id"))
										
										d3.selectAll(".container").remove()
										key_mbdata = new Array()
										for (let item of mbdata[choice]){
											if (x0 <= new Date(item.date) && new Date(item.date) <= x1 && item.message.toLowerCase().indexOf(d3.select(this).attr("id")) !== -1){
												key_mbdata.push(item)
											}
										}
										d3.select("#blocktitle").text(key_mbdata.length+"/"+mbdata[choice].length)
										var container = d3.select("#Relevantblock")
											.selectAll(".container").data(key_mbdata).enter()
											.append("div")
											.attr("class", "container")
											.attr("id", "container_"+choice)
										container.append("p").text(d=>d.time).attr("class", "time")
										var text = container.append('p')
											.attr('class', 'text')
										text.append("span")
											.text(d=>d.author+": ")
											.attr("class", "author")
										text.append("span")
											.text(d=>d.rt)
											.attr("class", "tags")
										text.append("span")
											.text(d=>d.message)
										text.append("span")
											.text(d=>d.tags)
											.attr("class", "tags")
									}
								});
						}
					}
					
					// 右边文字信息处理
					d3.select("#blocktitle").text(mbdata["Relevant"].length+"/"+mbdata["Relevant"].length)
					for (let choice of ["Relevant", "Chatter", "Spam"]){
						var container = d3.select("#"+choice+"block")
							.selectAll('.container').data(mbdata[choice]).enter()
							.append('div')
							.attr('class', 'container')
							.attr("id", "container_"+choice)
						container.append("p").text(d=>d.time).attr("class", "time")
						var text = container.append('p')
							.attr('class', 'text')
						text.append("span")
							.text(d=>d.author+": ")
							.attr("class", "author")
						text.append("span")
							.text(d=>d.rt)
							.attr("class", "tags")
						text.append("span")
							.text(d=>d.message)
						text.append("span")
							.text(d=>d.tags)
							.attr("class", "tags")
					}
						
					d3.selectAll("#test")
						.on("change", function(){
							d3.selectAll(".container").remove()
							if (+document.single.test.value == 0){var choice = "Relevant"}
							if (+document.single.test.value == 1){var choice = "Chatter"}
							if (+document.single.test.value == 2){var choice = "Spam"}
							if (+document.single.test.value == 3){
								d3.selectAll(".keyword").attr("opacity", 0)
								
								var container = d3.select("#Relevantblock")
									.selectAll('.container').data(mbdata.ccdata).enter()
									.append('div')
									.attr('class', 'container')
									.attr("id", "container_cc")
								container.append("p").text(d=>d.time).attr("style", "margin:10px")
								var text = container.append('p')
									.attr('class', 'text')
								text.append("span")
									.text(d=>d.location !== 0 ? d.location+": " : "")
									.attr("class", "author")
								text.append("span")
									.text(d=>d.message)
							} else {
								d3.select("#blocktitle").text(mbdata[choice].length+"/"+mbdata[choice].length)
								
								var container = d3.select("#Relevantblock")
									.selectAll('.container').data(mbdata[choice]).enter()
									.append('div')
									.attr('class', 'container')
									.attr("id", "container_"+choice)
								container.append("p").text(d=>d.time).attr("class", "time")
								var text = container.append('p')
									.attr('class', 'text')
								text.append("span")
									.text(d=>d.author+": ")
									.attr("class", "author")
								text.append("span")
									.text(d=>d.rt)
									.attr("class", "tags")
								text.append("span")
									.text(d=>d.message)
								text.append("span")
									.text(d=>d.tags)
									.attr("class", "tags")
									
								d3.selectAll("#cloud").remove()
								var worddict = {}
								for (let item of mbdata[choice]){
									for (let key in item.tfidf){
										if (x0 <= new Date(item.date) && new Date(item.date) <= x1){
											if (key in worddict){
												worddict[key] += item.tfidf[key]
											} else {
												worddict[key] = item.tfidf[key]
											}
										}
									}
								}
								var res = Object.keys(worddict).sort(function(a,b){return -worddict[a]+worddict[b];})
								var words = new Array()
								var n = 0
								for (let word of res){
									if (n>50){break}
									words.push({"text":word, "size":10+100*worddict[word]/d3.max(Object.values(worddict),d=>d)})
									n += 1
								}
								
								d3.layout.cloud().size([500, 500])
								.words(words)
								.rotate(function() { return 0; })
								.rotate(function() { return ~~(Math.random() * 2) * 90; })
										.font("Impact")
										.fontSize(function(d) { return d.size; })
										.on("end", draw)//结束时运行draw函数
										.start();
							}
						});
					
					var worddict = {}
					for (let item of mbdata.Relevant){
						for (let key in item.tfidf){
							if (key in worddict){
								worddict[key] += item.tfidf[key]
							} else {
								worddict[key] = item.tfidf[key]
							}
						}
					}
					var res = Object.keys(worddict).sort(function(a,b){return -worddict[a]+worddict[b];})
					words = new Array()
					var n = 0
					for (let word of res){
						if (n>50){break}
						words.push({"text":word, "size":10+worddict[word]})
						n += 1
					}
					
					svg.append("rect").attr("width", 500).attr("height", 500)
						.attr("transform", `translate(${width-11*margin}, ${1*margin})`)
						.attr("rx", 10).attr("ry", 10)
						.attr("fill", "white")
						.attr("stroke", "gray")
						.attr("stroke-width", "1px")
						.attr("opacity", 1)
						
					// svg.append("rect").attr("width", 500).attr("height", 500)
					// 	.attr("transform", `translate(${width/2+1.5*margin}, ${height/2+0.5*margin})`)
					// 	.attr("rx", 10).attr("ry", 10)
					// 	.attr("fill", "white")
					// 	.attr("stroke", "gray")
					// 	.attr("stroke-width", "1px")
					// 	.attr("opacity", 1)
					
					var fill = d3.scaleOrdinal(d3.schemeCategory10);
					var fill = d3.scaleOrdinal(["#89cfd7", "#938ad7", "#d7ac8d", "#d78bb0", "#8bd7ba", "#cdd78d"]);
					var cloud = d3.layout.cloud().size([500, 500])
					.words(words)
					.rotate(function() { return ~~(Math.random() * 2) * 90; })
							.font("Impact")
							.fontSize(function(d) { return d.size; })
							.on("end", draw)//结束时运行draw函数
							.start();
					function draw(words) {
						var choice = document.getElementById("test")[+document.single.test.value].id
						svg.append("g").attr("id", "cloud")
							.attr("style", "border:1px solid red")
							.attr("transform", `translate(${width-7.5*margin},${4.6*margin})`)
							.selectAll("text")
							.data(words)
							.enter().append("text")
							.style("border","1px solid blue")
							.style("font-size", function(d) { return d.size + "px"; })
							.style("font-family", "Impact")
							.style("fill", function(d, i) { return fill(i); })//fill 在前面15行定义为颜色集
							.attr("text-anchor", "middle")
							.attr("class", "keyword")
							.attr("id", d=>d.text)
							.attr("transform", function(d) {
								return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
							})
							.text(function(d) { return d.text; })
							.on("click", function (){
								if (d3.select(this).attr("opacity")==0.9){
									d3.selectAll(".keyword").attr("opacity", 1)
									
									d3.selectAll(".container").remove()
									key_mbdata = new Array()
									for (let item of mbdata[choice]){
										if (x0 <= new Date(item.date) && new Date(item.date) <= x1){
											key_mbdata.push(item)
										}
									}
									d3.select("#blocktitle").text(key_mbdata.length+"/"+mbdata[choice].length)
									var container = d3.select("#Relevantblock")
										.selectAll(".container").data(key_mbdata).enter()
										.append("div")
										.attr("class", "container")
										.attr("id", "container_"+choice)
									container.append("p").text(d=>d.time).attr("class", "time")
									var text = container.append('p')
										.attr('class', 'text')
									text.append("span")
										.text(d=>d.author+": ")
										.attr("class", "author")
									text.append("span")
										.text(d=>d.rt)
										.attr("class", "tags")
									text.append("span")
										.text(d=>d.message)
									text.append("span")
										.text(d=>d.tags)
										.attr("class", "tags")
								} else {
									d3.selectAll(".keyword").attr("opacity", 0.3)
									d3.select(this).attr("opacity", 0.9)
									
									console.log(d3.select(this).attr("id"))
									
									d3.selectAll(".container").remove()
									key_mbdata = new Array()
									for (let item of mbdata[choice]){
										if (x0 <= new Date(item.date) && new Date(item.date) <= x1 && item.message.toLowerCase().indexOf(d3.select(this).attr("id")) !== -1){
											key_mbdata.push(item)
										}
									}
									d3.select("#blocktitle").text(key_mbdata.length+"/"+mbdata[choice].length)
									var container = d3.select("#Relevantblock")
										.selectAll(".container").data(key_mbdata).enter()
										.append("div")
										.attr("class", "container")
										.attr("id", "container_"+choice)
									container.append("p").text(d=>d.time).attr("class", "time")
									var text = container.append('p')
										.attr('class', 'text')
									text.append("span")
										.text(d=>d.author+": ")
										.attr("class", "author")
									text.append("span")
										.text(d=>d.rt)
										.attr("class", "tags")
									text.append("span")
										.text(d=>d.message)
									text.append("span")
										.text(d=>d.tags)
										.attr("class", "tags")
								}
							});
					}
					
					d3.select(".year").text("3 num of topic");
					let slider = d3.select(".slider")
						.append("input")
						.attr("type", "range")
						.attr("value", 3)
						.attr("min", 3) // 起始点值
						.attr("max", 15) // 终止点值
						.attr("step", 1) // 步长
						.attr("class", "input_topic")
						.on("input", function() {
							// 获取slider输入的值
							let year = this.value; 
							mapUpdate(year);
						});
						
					function mapUpdate(year){
						slider.property("value", year); // 更新slider的特殊属性value，
						d3.select(".year").text(year+" num of topic"); // 更新slider旁边的text
						
						d3.select("#lsi").remove()
						
						d3.select(".lsiblock").append("div")
						.attr("id", "lsi")
						.attr("style", "position: relative;top:250px;left:430px;transform: scale(1.4);")
						
						d3.json("lda_pass.json").then(function (data){
							data = data[0]
							function LDAvis_load_lib(url, callback){
							  var s = document.createElement('script');
							  s.src = url;
							  s.async = true;
							  s.onreadystatechange = s.onload = callback;
							  s.onerror = function(){console.warn("failed to load library " + url);};
							  document.getElementsByTagName("head")[0].appendChild(s);
							}
							
							if(typeof(LDAvis) !== "undefined"){
							   // already loaded: just create the visualization
							   !function(LDAvis){
							       new LDAvis("#lsi", data[year]);
							   }(LDAvis);
							}else if(typeof define === "function" && define.amd){
							   // require.js is available: use it to load d3/LDAvis
							   require.config({paths: {d3: "https://d3js.org/d3.v5"}});
							   require(["d3"], function(d3){
							      window.d3 = d3;
							      LDAvis_load_lib("https://cdn.jsdelivr.net/gh/bmabey/pyLDAvis@3.3.1/pyLDAvis/js/ldavis.v3.0.0.js", function(){
							        new LDAvis("#lsi", data[year]);
							      });
							    });
							}else{
							    // require.js not available: dynamically load d3 & LDAvis
							    LDAvis_load_lib("https://d3js.org/d3.v5.js", function(){
							         LDAvis_load_lib("https://cdn.jsdelivr.net/gh/bmabey/pyLDAvis@3.3.1/pyLDAvis/js/ldavis.v3.0.0.js", function(){
							                 new LDAvis("#lsi", data[year]);
							            })
							         });
							}
						})
					}
					
					var ldavis_data = {"mdsDat": {"x": [0.18983984843144996, -0.25702996462318156, 0.06719011619173162], "y": [-0.1730660170860614, -0.0654694200373035, 0.23853543712336484], "topics": [1, 2, 3], "cluster": [1, 1, 1], "Freq": [39.6798919404312, 31.143423853274204, 29.176684206294603]}, "tinfo": {"Term": ["fire", "dancing", "dolphin", "van", "people", "control", "buildings", "ithakis", "gelato", "still", "abila", "building", "alexandrias", "scene", "terrorists", "galore", "area", "surrounding", "likely", "explosion", "guys", "additional", "avoid", "hostages", "officials", "inside", "arrived", "near", "units", "down", "van", "people", "building", "still", "inside", "hostages", "guy", "down", "several", "cops", "like", "apd", "reports", "cant", "cop", "gelatogalore", "stand", "think", "back", "black", "get", "names", "released", "got", "peaceful", "looks", "shooting", "unknown", "hostage", "suspects", "swat", "arrested", "says", "please", "heard", "explosion", "apartment", "standoff", "police", "fire", "dancing", "dolphin", "buildings", "control", "scene", "surrounding", "additional", "area", "likely", "units", "officials", "arrived", "neighboring", "risk", "injured", "firefighter", "help", "one", "site", "businesses", "department", "oh", "collapsed", "top", "paramedics", "hospital", "measures", "yet", "residents", "afd", "abila", "apartment", "police", "explosion", "im", "standoff", "ithakis", "alexandrias", "galore", "pok", "near", "avoid", "terrorists", "that", "rally", "gelato", "intersection", "shots", "lame", "statements", "wnat", "fired", "corner", "situation", "end", "park", "may", "up", "thanks", "creator", "gonna", "sure", "guys", "advised", "city", "didnt", "around", "bad", "us", "stay", "police", "give", "abila"], "Freq": [308.0, 178.0, 158.0, 140.0, 122.0, 88.0, 85.0, 73.0, 74.0, 96.0, 129.0, 92.0, 65.0, 68.0, 64.0, 62.0, 63.0, 62.0, 56.0, 190.0, 55.0, 56.0, 52.0, 71.0, 54.0, 69.0, 52.0, 48.0, 52.0, 67.0, 139.94396839043176, 121.78726920308794, 92.07865903300947, 95.73264324546477, 68.64188276174808, 70.62218751051417, 64.24275993188849, 66.25170672760333, 58.20157574530009, 58.54634318726084, 59.23436979587032, 59.02687565260976, 57.67337064517287, 40.123256260915895, 39.10013693604676, 44.892761906407856, 64.91773844065102, 37.36744999676961, 36.55537533573615, 36.26545242827563, 35.00084456037012, 53.08476187191906, 45.86776066909898, 31.8048926860839, 34.65473839753678, 28.62969225065436, 27.862374900306172, 25.87912445948775, 33.210825444593205, 50.26181204975506, 42.667777448215354, 54.91618263887832, 56.9366388911688, 37.361075255979365, 82.62751237094064, 126.9286153262588, 63.63664583217082, 44.373206613355286, 42.15694788213569, 307.95840359557377, 177.29533917316732, 157.66096311901947, 84.90621004009107, 87.45932214889193, 67.95398769371575, 61.778729067147616, 55.6527329965716, 62.34643424228125, 56.19324266663934, 51.32767443682551, 53.64160831534424, 51.404223864611005, 47.06069333604278, 46.86098553204381, 41.21816452379148, 36.800603111143836, 42.707187944310604, 44.72152237839996, 30.48613535781904, 39.35047765981782, 28.510018036859442, 35.642645041514335, 27.04556034864055, 29.395149099452418, 23.233887458291772, 22.979435094650253, 21.119627617807495, 32.33722724335088, 20.337365559221748, 52.72257821061284, 101.14056798090765, 76.09931556112913, 90.60573800639415, 62.56225834251923, 36.46120352571897, 38.22978529761207, 73.36305010588572, 65.33193186052134, 61.580003511085316, 45.478291998308755, 48.032713343467904, 51.7498186721345, 63.99606317342245, 41.358334523737724, 35.302240168313126, 73.21187122914152, 34.16114891393939, 30.709382573388375, 27.325581971514456, 24.498350524186648, 24.498350524186648, 25.64216040810747, 24.028954291195795, 25.608398043629514, 42.242188715422294, 21.757489993393705, 36.36057790234606, 32.95942905730482, 22.410802166524956, 21.860764421773688, 22.902632210480654, 21.52828961200907, 54.27781665003246, 19.578557722619568, 17.420226374306594, 21.586130735103904, 40.393978380331085, 24.349704196938394, 53.7492711511873, 38.65773985520991, 90.04345941288938, 30.42374411249446, 27.588872218267046], "Total": [308.0, 178.0, 158.0, 140.0, 122.0, 88.0, 85.0, 73.0, 74.0, 96.0, 129.0, 92.0, 65.0, 68.0, 64.0, 62.0, 63.0, 62.0, 56.0, 190.0, 55.0, 56.0, 52.0, 71.0, 54.0, 69.0, 52.0, 48.0, 52.0, 67.0, 140.73660247571306, 122.58379641882026, 92.92163462371425, 96.71395357710122, 69.41224190037268, 71.47664071054868, 65.06156741109064, 67.12187451396949, 58.96747919657368, 59.33675146801653, 60.04937105017374, 60.00338303173772, 58.647381187170296, 40.89720921899371, 39.879267344623635, 45.80368380163583, 66.25704158831182, 38.15769241114703, 37.33249119845348, 37.072395141513546, 35.7883405269689, 54.28709327104435, 46.964245883352916, 32.60774894054249, 35.53127201110075, 29.427871313508483, 28.669551450887493, 26.68436736128177, 34.27813049162653, 51.92418598046468, 44.27081984903578, 57.29365858593624, 60.11647103732288, 39.011127361188045, 95.36082435962655, 190.21438395969983, 140.19695131460574, 83.7489660221829, 222.8061453014192, 308.7429411482509, 178.03197217748678, 158.40092481650333, 85.64297022785739, 88.31094400518094, 68.76279210502577, 62.58864279398967, 56.38367062634031, 63.18560886765077, 56.95354929986406, 52.059680066860096, 54.40910630691484, 52.140586398957524, 47.854744076946574, 47.672223283871936, 41.96483772044953, 37.5437411142641, 43.63906403570328, 45.72788480927563, 31.223691538332368, 40.36874609771929, 29.25695130826432, 36.58755601379212, 27.824198805189504, 30.259340017346858, 23.968526591040533, 23.747497724619933, 21.858291518670114, 33.47953350127772, 21.06836999328444, 57.65211026178058, 129.01733673733003, 140.19695131460574, 222.8061453014192, 190.21438395969983, 58.02240143486709, 83.7489660221829, 73.94381958326915, 65.9152928576634, 62.183574578576135, 46.04980310991938, 48.65607091841929, 52.4629634367418, 64.90479283831273, 41.98839647552811, 35.871483614101095, 74.40160832576643, 34.775613894088885, 31.342034055175933, 27.930490354266308, 25.067897225107416, 25.067897225107416, 26.251490163998497, 24.60622503296397, 26.228067850016426, 43.28439188848613, 22.322134971874377, 37.349051125225756, 33.9268237691756, 23.076348637362152, 22.52141856353467, 23.59654336602599, 22.191894332116473, 55.95121415554509, 20.193620200752466, 17.985247027875104, 22.290586275190932, 42.6369773836294, 25.36264434937815, 82.16137206511983, 55.27741296661754, 222.8061453014192, 45.90230480787626, 129.01733673733003], "Category": ["Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Default", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic1", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic2", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3", "Topic3"], "logprob": [30.0, 29.0, 28.0, 27.0, 26.0, 25.0, 24.0, 23.0, 22.0, 21.0, 20.0, 19.0, 18.0, 17.0, 16.0, 15.0, 14.0, 13.0, 12.0, 11.0, 10.0, 9.0, 8.0, 7.0, 6.0, 5.0, 4.0, 3.0, 2.0, 1.0, -3.6593, -3.7983, -4.0779, -4.039, -4.3716, -4.3432, -4.4379, -4.4071, -4.5366, -4.5307, -4.519, -4.5225, -4.5457, -4.9086, -4.9344, -4.7963, -4.4274, -4.9797, -5.0017, -5.0097, -5.0452, -4.6286, -4.7748, -5.1409, -5.0551, -5.2461, -5.2733, -5.3471, -5.0977, -4.6833, -4.8471, -4.5947, -4.5586, -4.9799, -4.1862, -3.7569, -4.4473, -4.8079, -4.8591, -2.6283, -3.1805, -3.2978, -3.9167, -3.8871, -4.1395, -4.2347, -4.3392, -4.2256, -4.3295, -4.4201, -4.376, -4.4186, -4.5069, -4.5111, -4.6394, -4.7528, -4.6039, -4.5578, -4.941, -4.6858, -5.008, -4.7847, -5.0608, -4.9775, -5.2127, -5.2237, -5.3081, -4.8821, -5.3458, -4.3932, -3.7418, -4.0263, -3.8518, -4.2221, -4.762, -4.7147, -3.9976, -4.1136, -4.1727, -4.4758, -4.4212, -4.3466, -4.1342, -4.5708, -4.7291, -3.9997, -4.762, -4.8685, -4.9852, -5.0945, -5.0945, -5.0488, -5.1138, -5.0501, -4.5496, -5.2131, -4.6996, -4.7978, -5.1835, -5.2084, -5.1618, -5.2237, -4.2989, -5.3186, -5.4354, -5.221, -4.5944, -5.1005, -4.3087, -4.6383, -3.7928, -4.8778, -4.9756], "loglift": [30.0, 29.0, 28.0, 27.0, 26.0, 25.0, 24.0, 23.0, 22.0, 21.0, 20.0, 19.0, 18.0, 17.0, 16.0, 15.0, 14.0, 13.0, 12.0, 11.0, 10.0, 9.0, 8.0, 7.0, 6.0, 5.0, 4.0, 3.0, 2.0, 1.0, 0.9187, 0.9178, 0.9152, 0.9141, 0.9132, 0.9123, 0.9117, 0.9113, 0.9113, 0.9109, 0.9107, 0.9079, 0.9076, 0.9052, 0.9046, 0.9042, 0.9039, 0.9034, 0.9033, 0.9023, 0.9021, 0.9019, 0.9007, 0.8994, 0.8993, 0.8968, 0.8958, 0.8937, 0.8927, 0.8918, 0.8874, 0.8819, 0.87, 0.8811, 0.781, 0.5198, 0.1345, 0.2891, -0.7406, 1.164, 1.1624, 1.1619, 1.1579, 1.1569, 1.1547, 1.1535, 1.1535, 1.1532, 1.1531, 1.1524, 1.1524, 1.1523, 1.1498, 1.1494, 1.1486, 1.1466, 1.145, 1.1443, 1.1427, 1.141, 1.1407, 1.1404, 1.1382, 1.1376, 1.1354, 1.1337, 1.1322, 1.1319, 1.1313, 1.0772, 0.9231, 0.5556, 0.2668, 0.0546, 0.702, 0.3824, 1.2239, 1.2229, 1.222, 1.2193, 1.2189, 1.2181, 1.2177, 1.2167, 1.2158, 1.2157, 1.214, 1.2114, 1.2099, 1.2088, 1.2088, 1.2083, 1.2081, 1.2079, 1.2074, 1.2062, 1.205, 1.2029, 1.2025, 1.202, 1.202, 1.2014, 1.2014, 1.2009, 1.1999, 1.1997, 1.1778, 1.191, 0.8074, 0.8742, 0.3258, 0.8205, -0.3107]}, "token.table": {"Topic": [2, 3, 2, 3, 1, 2, 3, 1, 2, 1, 2, 3, 1, 3, 1, 2, 3, 2, 3, 1, 1, 3, 1, 3, 1, 2, 2, 3, 1, 3, 2, 2, 1, 1, 3, 3, 2, 2, 3, 2, 1, 3, 1, 3, 1, 2, 3, 2, 3, 2, 3, 1, 3, 1, 3, 1, 1, 3, 3, 1, 1, 3, 1, 3, 1, 2, 2, 3, 2, 1, 3, 1, 3, 1, 2, 3, 2, 1, 3, 3, 3, 1, 3, 2, 1, 2, 3, 2, 1, 3, 3, 2, 2, 2, 3, 2, 3, 2, 3, 1, 3, 1, 1, 3, 3, 1, 2, 3, 3, 1, 3, 1, 2, 2, 2, 1, 2, 2, 1, 1, 3, 2, 3, 1, 3, 1, 2, 3, 3, 1, 3, 1, 2, 3, 2, 3, 1, 2, 3, 1, 2, 3, 1, 3, 3, 3, 1, 2, 3, 2, 1, 3, 2, 3, 1, 2, 3, 1, 3, 1, 2], "Freq": [0.7828405279022981, 0.21702509684420146, 0.9931953591868303, 0.9904118132941189, 0.06938167539465988, 0.9193071989792434, 0.9861141046639985, 0.456500654257326, 0.5420945269305746, 0.9832778923280543, 0.9812360933304582, 0.015826388602104165, 0.04690764033305762, 0.9381528066611524, 0.9599666238368086, 0.017453938615214704, 0.03490787723042941, 0.9781247876609932, 0.9911754234527749, 0.9910937848565741, 0.03942806539510216, 0.9462735694824518, 0.9710729469347752, 0.026974248525965975, 0.9900815926512011, 0.9924924342751456, 0.9660939159614715, 0.024771638870806963, 0.9780618473453924, 0.9452191551026192, 0.9703783454481434, 0.985155361886925, 0.9779517678440456, 0.9943247404064909, 0.9753629403879777, 0.976847880959909, 0.9942034446685903, 0.9912174270805948, 0.9869637221918047, 0.9974689237643797, 0.9832860073993315, 0.01489827283938381, 0.02310301603812078, 0.9703266736010728, 0.6676676987104567, 0.33120523636817933, 0.005257225974098084, 0.9975936578647343, 0.9904199661646869, 0.9855171302026288, 0.9970478606316823, 0.013440569666471638, 0.9811615856524296, 0.9824537300293056, 0.021832305111762346, 0.9779721407765517, 0.32678097674577306, 0.6535619534915461, 0.9747190358870577, 0.9813618247107253, 0.9836836483759585, 0.01537005700587435, 0.01787271313219383, 0.9651265091384668, 0.870378381870828, 0.12583783834277032, 0.9853556887659087, 0.022915248575951366, 0.9685230952208925, 0.9627129463218903, 0.029173119585511827, 0.9933315177404758, 0.01399058475690811, 0.36192917701921556, 0.6204500177472267, 0.017234722715200743, 0.9770084248418441, 0.9940609626041993, 0.9776966153221317, 0.9872359909376023, 0.9666854988056385, 0.9825248619290792, 0.016652963761509817, 0.9832574209757576, 0.9854603376183695, 0.026774441916801322, 0.9638799090048475, 0.9607338241446267, 0.9762909893771958, 0.01842058470523011, 0.9865161550031586, 0.982138780732539, 0.9924809221344838, 0.9839410969792398, 0.027331697138312218, 0.9840822550111047, 0.021868494555802327, 0.9595917342953167, 0.9855688099601466, 0.9850477626881817, 0.028144221791090905, 0.9952375726982247, 0.9484473406121325, 0.025633711908436014, 0.9772028751694435, 0.1885046749638843, 0.4084267957550826, 0.40393858920832343, 0.9757053925208012, 0.9794685113064978, 0.0212927937240543, 0.9889614647054025, 0.017051059736300042, 0.949290334580939, 0.9858990574056286, 0.9481594480922202, 0.04990312884695895, 0.9889069061672088, 0.9835930039785405, 0.976645904208356, 0.9890870498521633, 0.9608088769122614, 0.9913044357167056, 0.9810278038653997, 0.015092735444083072, 0.5253796206671442, 0.45373694512162455, 0.011940445924253277, 0.9573998083876842, 0.28944914642916675, 0.7055322944210939, 0.9926178844862127, 0.010339769630064716, 0.99135295395496, 0.9905950541869523, 0.015977339583660523, 0.9629423948757019, 0.019258847897514038, 0.019258847897514038, 0.971294413490211, 0.02258824217419095, 0.02258824217419095, 0.015407182678960941, 0.9860596914535003, 0.9533570646605906, 0.9764602471517536, 0.9696603138713694, 0.9583817751271206, 0.033047647418176576, 0.979644898595244, 0.974353247651853, 0.03747512490968666, 0.02947520247706051, 0.9726816817429969, 0.25559456314039797, 0.08519818771346599, 0.6572431623610233, 0.9947660916722771, 0.9573998083876842, 0.029868994439896712, 0.9558078220766948], "Term": ["abila", "abila", "additional", "advised", "afd", "afd", "alexandrias", "apartment", "apartment", "apd", "area", "area", "around", "around", "arrested", "arrested", "arrested", "arrived", "avoid", "back", "bad", "bad", "black", "black", "building", "buildings", "businesses", "businesses", "cant", "city", "collapsed", "control", "cop", "cops", "corner", "creator", "dancing", "department", "didnt", "dolphin", "down", "down", "end", "end", "explosion", "explosion", "explosion", "fire", "fired", "firefighter", "galore", "gelato", "gelato", "gelatogalore", "gelatogalore", "get", "give", "give", "gonna", "got", "guy", "guy", "guys", "guys", "heard", "heard", "help", "help", "hospital", "hostage", "hostage", "hostages", "hostages", "im", "im", "im", "injured", "inside", "intersection", "ithakis", "lame", "like", "like", "likely", "looks", "may", "may", "measures", "names", "names", "near", "neighboring", "officials", "oh", "oh", "one", "one", "paramedics", "park", "peaceful", "peaceful", "people", "please", "please", "pok", "police", "police", "police", "rally", "released", "released", "reports", "reports", "residents", "risk", "says", "says", "scene", "several", "shooting", "shots", "site", "situation", "stand", "stand", "standoff", "standoff", "standoff", "statements", "stay", "stay", "still", "still", "sure", "surrounding", "surrounding", "suspects", "suspects", "suspects", "swat", "swat", "swat", "terrorists", "terrorists", "thanks", "that", "think", "top", "top", "units", "unknown", "unknown", "up", "up", "us", "us", "us", "van", "wnat", "yet", "yet"]}, "R": 30, "lambda.step": 0.01, "plot.opts": {"xlab": "PC1", "ylab": "PC2"}, "topic.order": [2, 1, 3]};
					function LDAvis_load_lib(url, callback){
					  var s = document.createElement('script');
					  s.src = url;
					  s.async = true;
					  s.onreadystatechange = s.onload = callback;
					  s.onerror = function(){console.warn("failed to load library " + url);};
					  document.getElementsByTagName("head")[0].appendChild(s);
					}
					
					if(typeof(LDAvis) !== "undefined"){
					   // already loaded: just create the visualization
					   !function(LDAvis){
					       new LDAvis("#lsi", ldavis_data);
					   }(LDAvis);
					}else if(typeof define === "function" && define.amd){
					   // require.js is available: use it to load d3/LDAvis
					   require.config({paths: {d3: "https://d3js.org/d3.v5"}});
					   require(["d3"], function(d3){
					      window.d3 = d3;
					      LDAvis_load_lib("https://cdn.jsdelivr.net/gh/bmabey/pyLDAvis@3.3.1/pyLDAvis/js/ldavis.v3.0.0.js", function(){
					        new LDAvis("#lsi", ldavis_data);
					      });
					    });
					}else{
					    // require.js not available: dynamically load d3 & LDAvis
					    LDAvis_load_lib("https://d3js.org/d3.v5.js", function(){
					         LDAvis_load_lib("https://cdn.jsdelivr.net/gh/bmabey/pyLDAvis@3.3.1/pyLDAvis/js/ldavis.v3.0.0.js", function(){
					                 new LDAvis("#lsi", ldavis_data);
					            })
					         });
					}
				})
			})
		</script>
		
		<form name="block" id="form" action="" method="" style="position:absolute;top:0px;left:2020px;">
		<div id="outerblock" class="textblock" style="width: 537px;height: 700px;">
			<p align="middle" style="font-weight:bold;font-size:20pt;">Relevant Message View</p>
			<p align="middle" id="blocktitle" style="font-weight:bold;font-size:20pt;"></p>
		</div>
		</form>

		<form name="relevant" action="" method="" style="position:absolute;top:135px;left:2020px;">
		<div id="Relevantblock" class="textblock" style="width: 537px;height: 1254px;">
		</div>
		</form>

		<form name="single" action="" method=""  style="position:absolute;top:30px;left:2100px;">
		<select id="test"  name="test"  style = "height:50px;font-size:30px;border-radius:10px;background:white;color:black">          
			<option value="0" id="Relevant">Relevant Message View</option>
			<option value="1" id="Chatter">Chatter Message View</option>
			<option value="2" id="Spam">Spam Message View</option>
			<option value="3" id="ccdata">ccdata Message View</option>
		</select>
		</form>
		
	</body>
</html>
